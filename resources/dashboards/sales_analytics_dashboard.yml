resources:
  dashboards:
    sales_analytics_dashboard:
      display_name: "Sales Analytics Dashboard"
      warehouse_id: "${var.warehouse_id}"
      
      # Dashboard metadata
      tags:
        - key: "environment"
          value: "${var.environment}"
        - key: "layer"
          value: "gold"
        - key: "purpose"
          value: "sales_reporting"
      
      # Dashboard definition
      serialized_dashboard: |
        {
          "pages": [
            {
              "name": "Sales Overview",
              "displayName": "Sales Overview",
              "layout": [
                {
                  "widget": {
                    "name": "total_sales_metric",
                    "textbox_spec": "# Total Sales\n\nKey metrics from the sales fact table"
                  },
                  "position": {
                    "x": 0,
                    "y": 0,
                    "width": 2,
                    "height": 2
                  }
                },
                {
                  "widget": {
                    "name": "total_revenue",
                    "queries": [
                      {
                        "name": "total_revenue_query",
                        "query": {
                          "dataset_name": "${var.gold_catalog}.${resources.schemas.gold_schema.name}.fact_sales",
                          "query_string": "SELECT SUM(order_extended_price_usd) as total_revenue FROM ${var.gold_catalog}.${resources.schemas.gold_schema.name}.fact_sales"
                        }
                      }
                    ],
                    "spec": {
                      "version": 2,
                      "widgetType": "counter",
                      "encodings": {
                        "value": {
                          "fieldName": "total_revenue",
                          "displayName": "Total Revenue (USD)"
                        }
                      }
                    }
                  },
                  "position": {
                    "x": 2,
                    "y": 0,
                    "width": 2,
                    "height": 2
                  }
                },
                {
                  "widget": {
                    "name": "total_orders",
                    "queries": [
                      {
                        "name": "total_orders_query",
                        "query": {
                          "dataset_name": "${var.gold_catalog}.${resources.schemas.gold_schema.name}.fact_sales",
                          "query_string": "SELECT COUNT(DISTINCT order_header_code) as total_orders FROM ${var.gold_catalog}.${resources.schemas.gold_schema.name}.fact_sales"
                        }
                      }
                    ],
                    "spec": {
                      "version": 2,
                      "widgetType": "counter",
                      "encodings": {
                        "value": {
                          "fieldName": "total_orders",
                          "displayName": "Total Orders"
                        }
                      }
                    }
                  },
                  "position": {
                    "x": 4,
                    "y": 0,
                    "width": 2,
                    "height": 2
                  }
                },
                {
                  "widget": {
                    "name": "revenue_by_customer_segment",
                    "queries": [
                      {
                        "name": "revenue_by_segment_query",
                        "query": {
                          "dataset_name": "${var.gold_catalog}.${resources.schemas.gold_schema.name}.fact_sales",
                          "query_string": "SELECT c.customer_segment, SUM(f.order_extended_price_usd) as total_revenue FROM ${var.gold_catalog}.${resources.schemas.gold_schema.name}.fact_sales f JOIN ${var.gold_catalog}.${resources.schemas.gold_schema.name}.dim_customer c ON f.customer_id = c.customer_id GROUP BY c.customer_segment ORDER BY total_revenue DESC"
                        }
                      }
                    ],
                    "spec": {
                      "version": 2,
                      "widgetType": "bar",
                      "encodings": {
                        "x": {
                          "fieldName": "customer_segment",
                          "displayName": "Customer Segment"
                        },
                        "y": {
                          "fieldName": "total_revenue",
                          "displayName": "Revenue (USD)"
                        }
                      }
                    }
                  },
                  "position": {
                    "x": 0,
                    "y": 2,
                    "width": 3,
                    "height": 4
                  }
                },
                {
                  "widget": {
                    "name": "revenue_by_region",
                    "queries": [
                      {
                        "name": "revenue_by_region_query",
                        "query": {
                          "dataset_name": "${var.gold_catalog}.${resources.schemas.gold_schema.name}.fact_sales",
                          "query_string": "SELECT c.customer_region, SUM(f.order_extended_price_usd) as total_revenue FROM ${var.gold_catalog}.${resources.schemas.gold_schema.name}.fact_sales f JOIN ${var.gold_catalog}.${resources.schemas.gold_schema.name}.dim_customer c ON f.customer_id = c.customer_id GROUP BY c.customer_region ORDER BY total_revenue DESC"
                        }
                      }
                    ],
                    "spec": {
                      "version": 2,
                      "widgetType": "pie",
                      "encodings": {
                        "label": {
                          "fieldName": "customer_region",
                          "displayName": "Region"
                        },
                        "value": {
                          "fieldName": "total_revenue",
                          "displayName": "Revenue (USD)"
                        }
                      }
                    }
                  },
                  "position": {
                    "x": 3,
                    "y": 2,
                    "width": 3,
                    "height": 4
                  }
                },
                {
                  "widget": {
                    "name": "top_products",
                    "queries": [
                      {
                        "name": "top_products_query",
                        "query": {
                          "dataset_name": "${var.gold_catalog}.${resources.schemas.gold_schema.name}.fact_sales",
                          "query_string": "SELECT p.part_name, SUM(f.order_quantity) as total_quantity, SUM(f.order_extended_price_usd) as total_revenue FROM ${var.gold_catalog}.${resources.schemas.gold_schema.name}.fact_sales f JOIN ${var.gold_catalog}.${resources.schemas.gold_schema.name}.dim_part p ON f.part_id = p.part_id GROUP BY p.part_name ORDER BY total_revenue DESC LIMIT 10"
                        }
                      }
                    ],
                    "spec": {
                      "version": 2,
                      "widgetType": "table",
                      "encodings": {
                        "columns": [
                          {
                            "fieldName": "part_name",
                            "displayName": "Product Name"
                          },
                          {
                            "fieldName": "total_quantity",
                            "displayName": "Total Quantity"
                          },
                          {
                            "fieldName": "total_revenue",
                            "displayName": "Revenue (USD)"
                          }
                        ]
                      }
                    }
                  },
                  "position": {
                    "x": 0,
                    "y": 6,
                    "width": 6,
                    "height": 4
                  }
                },
                {
                  "widget": {
                    "name": "avg_order_lag",
                    "queries": [
                      {
                        "name": "avg_lag_query",
                        "query": {
                          "dataset_name": "${var.gold_catalog}.${resources.schemas.gold_schema.name}.fact_sales",
                          "query_string": "SELECT AVG(order_ship_lag_days) as avg_ship_lag, AVG(order_receipt_lag_days) as avg_receipt_lag FROM ${var.gold_catalog}.${resources.schemas.gold_schema.name}.fact_sales"
                        }
                      }
                    ],
                    "spec": {
                      "version": 2,
                      "widgetType": "table",
                      "encodings": {
                        "columns": [
                          {
                            "fieldName": "avg_ship_lag",
                            "displayName": "Avg Ship Lag (Days)"
                          },
                          {
                            "fieldName": "avg_receipt_lag",
                            "displayName": "Avg Receipt Lag (Days)"
                          }
                        ]
                      }
                    }
                  },
                  "position": {
                    "x": 0,
                    "y": 10,
                    "width": 3,
                    "height": 3
                  }
                }
              ]
            }
          ]
        }
