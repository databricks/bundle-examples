bundle:
  name: deploying_databricks_asset_bundles_dabs_at_scale



include:
  # Includes enable modularization of bundle configuration.
  - resources/*.yml
  - resources/*/*.yml



variables:

  source_table:
    # Variables can be used to parameterize the bundle.
    # Their value can be hardcoded, set per target,
    # or set at deployment time.
    description: "Source table for the ETL job"
    default: "samples.nyctaxi.trips"


  warehouse_id:
    # Lookup variables can refer to shared workspace fixtures by name.
    # This keeps the configuration portable across different workspaces.
    description: "Dynamic lookup of the ID for the named warehouse"
    lookup:
      warehouse: "Shared SQL warehouse"









permissions:
  # Make sure that all deployments (both development and production)
  # are visible to the same group.
  - level: CAN_VIEW
    group_name: "dabs-at-scale-example-group"





targets:
  development:
    mode: development

    workspace:
      host: https://nephos-west-2-1.cloud.databricks.com/
      root_path: ~/.bundle/${bundle.name}/${bundle.target}

    permissions:
      - level: CAN_MANAGE
        user_name: ${workspace.current_user.userName}

    variables:
      # Variable values can be overridden per target.
      # For example, you could consider using a subset of data
      # as input in development to iterate faster.
      source_table: "samples.nyctaxi.trips"






  production:
    mode: production

    workspace:
      host: https://nephos-west-2-1.cloud.databricks.com/

      # Pin to a specific path to avoid unintentionally creating
      # multiple production deployments in the same workspace.
      root_path: /Workspace/Users/1bd70829-9520-4b67-bb74-422906cec53e/.bundle/${bundle.name}/${bundle.target}

    permissions:
      - level: CAN_MANAGE
        service_principal_name: 1bd70829-9520-4b67-bb74-422906cec53e

    resources:
      jobs:
        nyc_taxi_etl:

          # Only notify on failure in production.
          email_notifications:
            on_failure:
              - pieter.noordhuis@databricks.com





sync:
  paths:
    # This defaults to `.`, i.e. the bundle root directory.
    # You can either narrow this down to specific directories,
    # or include additional paths outside this directory.
    - "."
  include:
    # Patterns for additional files to include in the bundle.
    # Files not matching `.gitignore` entries are included by default.
    - "additional/files*.txt"
  exclude:
    # Patterns for files to exclude from the bundle.
    - "files/to/exclude/**/*.py"
