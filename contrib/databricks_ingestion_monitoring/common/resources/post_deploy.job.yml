# A helper job to:
#  
# - Publish an AI/BI dashboard from a template. See jobs/publish_dashboard.ipynb or more info.
# - Update the column comments for monitoring tables. See jobs/update_monitoring_tables_meta.ipynb for more info. 
#
# This job should be run after the first successful execution of the monitoring ETL pipeline
# and after updates to the logic in the monitoring ETL pipeline.

resources:
  jobs:
    post_deploy:
      name: Post-deploy actions for ${var.dab_type} monitoring DAB
      email_notifications:
        on_failure: ${var.notification_emails}
      permissions: ${var.jobs_and_pipelines_permissions}
      tasks:
        - task_key: publish_main_dashboard
          notebook_task:
            notebook_path: ../src/publish_dashboard.ipynb
            base_parameters:
              dashboard_template_path: ${var.main_dashboard_template_path}
              dashboard_id: ${var.main_dashboard_id}
              published_dashboard_name: ${var.main_dashboard_name}
              default_dataset_catalog: ${var.monitoring_catalog}
              default_dataset_schema: ${resources.schemas.monitoring_schema.name}
              warehouse_id: ${var.warehouse_id}
        - task_key: update_table_metadata
          notebook_task:
            notebook_path: ../src/update_monitoring_tables_meta.ipynb
            base_parameters:
              monitoring_catalog: ${var.monitoring_catalog}
              monitoring_schema: ${resources.schemas.monitoring_schema.name}
